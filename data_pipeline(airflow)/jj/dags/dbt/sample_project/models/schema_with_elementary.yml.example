# dbt 모델 문서화 및 테스트 정의 (Elementary 포함)
# 이 파일은 모델에 대한 설명과 데이터 품질 테스트를 정의합니다
#
# Elementary를 사용하려면 이 파일을 schema.yml로 복사하거나
# 기존 schema.yml에 Elementary 설정을 추가하세요

version: 2

models:
  - name: stg_sample_data
    description: "Staging 모델: 원본 데이터를 정제하고 표준화"
    config:
      # Elementary freshness 체크 설정
      meta:
        elementary:
          freshness:
            # 1시간 후 경고, 2시간 후 에러
            warn_after: {count: 1, period: hour}
            error_after: {count: 2, period: hour}
            # 필터 조건 (선택사항)
            # filter: "updated_at >= CURRENT_DATE - INTERVAL '1 day'"
    columns:
      - name: id
        description: "제품 ID"
        tests:
          - unique
          - not_null
      - name: product_name
        description: "제품 이름"
        tests:
          - not_null
      - name: price
        description: "제품 가격"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: true
      - name: status_normalized
        description: "정규화된 상태 (소문자)"
        tests:
          - accepted_values:
              values: ['active', 'inactive']

  - name: dim_products
    description: "제품 차원 테이블: 비즈니스 로직이 적용된 제품 데이터"
    config:
      meta:
        elementary:
          # 데이터 드리프트 감지 설정
          anomaly_detection:
            # 타임스탬프 컬럼 (선택사항)
            # timestamp_column: updated_at
            # 통계적 이상치 감지
            statistical_anomalies: true
            # 값 분포 변화 감지
            distribution_anomalies: true
    columns:
      - name: product_id
        description: "제품 ID (Primary Key)"
        tests:
          - unique
          - not_null
      - name: price_category
        description: "가격대 분류 (Low, Medium, High)"
        tests:
          - accepted_values:
              values: ['Low', 'Medium', 'High']
      - name: is_active
        description: "활성 제품 여부"
        tests:
          - not_null

  - name: agg_product_summary
    description: "제품 요약 통계: 가격대별, 상태별 집계 데이터"
    config:
      meta:
        elementary:
          freshness:
            warn_after: {count: 6, period: hour}
            error_after: {count: 12, period: hour}
    columns:
      - name: product_count
        description: "제품 개수"
        tests:
          - not_null
      - name: total_price
        description: "총 가격"
        tests:
          - not_null
