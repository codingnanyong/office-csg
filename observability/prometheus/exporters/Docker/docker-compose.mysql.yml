services:
  mysql-exporter:
    image: prom/mysqld-exporter:latest
    container_name: mysql-exporter
    restart: always
    ports:
      - "9104:9104"
    environment:
      - DATA_SOURCE_NAME=${MYSQL_USER}:${MYSQL_PASSWORD}@(${MYSQL_HOST}:${MYSQL_PORT})/
    command:
      - '--collect.info_schema.tables'
      - '--collect.info_schema.innodb_metrics'
      - '--collect.global_status'
      - '--collect.global_variables'
      - '--collect.slave_status'
      - '--collect.info_schema.processlist'
      - '--collect.info_schema.innodb_cmp'
      - '--collect.info_schema.innodb_cmpmem'
      - '--collect.info_schema.query_response_time'
    networks:
      - prometheus-network
    healthcheck:
      test: ["CMD-SHELL", "wget --spider -q http://localhost:9104/metrics || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

networks:
  prometheus-network:
    external: true 